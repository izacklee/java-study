SpringCloud是官方推荐用微服务的spring框架
微服务：把以前的单体应用项目各个模块拆分成一个个独立的服务，服务独立，数据库独立。
分布式：把微服务中一个个独立的服务，分别部署到各个服务器上。
#### 1 微服务架构
   冷备份：关闭数据库并不能更新数据下进行完整备份。
  1）一个电商平台的例子——单体应用（模块代码一块 数据库公用）：
    浏览器->电商后台系统（用户模块/商品模块/订单模块/支付模块）-> 数据库
    问题：开发和维护难度大，数据库公用，就一个服务器，要是服务器崩了，那整个项目就挂了。
  2）服务独立——数据库公用（代码分离 但数据库还是公用）：
    浏览器->电商后台系统V2.0（用户服务/商品服务/订单服务/支付服务）->数据库
    问题：虽然服务独立（实际访问的还是一个大项目 就是原来有1台机 现在有4台 每台机分别对应一个服务 还是有单点风险 
    有一台机挂了 那整个项目也就挂了），但还有单点的风险，还有数据库也是公用的，尚存在瓶颈。 
  3）电商后台系统V2.0——负载均衡
    浏览器->F5（链路控制器 是一个负载均衡器 后面可挂很多服务 映射到多个路径 而这多个路径下可能有多台机 这个时候一旦
    有其中一台挂了 还能继续跑 不影响）/nginx（高性能的HTTP和反向代理web服务器）->电商后台系统V2.0（用户服务/商品服务
    /订单服务/支付服务）->数据库 
    问题：服务独立，也做了负载均衡了，但数据库还是公用的，还是存在瓶颈。
  4）微服务架构——服务治理
    PC浏览器/移动设备->网关系统（权限认证 熔断限流）->电商后台系统V3.0（用户服务（服务注册与发现）/商品服务（服务RPC
    调用）/订单服务（服务RPC（全称Remote Procedure Call，即远程过程调用）调用 RPC和HTTP/HTTPS协议一样属于应用层协议
    RPC应用于大项目 HTTP/HTTPS应用于小项目）/支付服务（熔断与降级））->（用户服务）数据库/（商品服务）数据库/
    （订单服务）数据库/（支付服务）数据库
#### 2 数据库表切分
  什么样的情况下才需要数据库切分？不是数据量大就需要切分，还要根据具体的业务需求来，比如2015年的数据很少查，很少用到，
  那么迁移到历史库就好，但如果是电商项目/消息订单，每天的数据量都很大，导致数据库压力很大，效率低，就需要做切分。
  1）垂直切分
    根据业务纬度拆成不同的库，如：订单库，商品库
    根据业务属性拆成不同的表，如：商品信息表，商品详情表
  2）水平切分（横向扩展）
    流量过大超过单库容量时，将一个库拆成多个库，从而分摊流量
#### 3 数据库切分策略
  1）范围切分
    优点：单表大小可控，天然水平扩展
    缺点：无法解决集中写入瓶颈的问题（比如热点数据在某一个范围的特别多）
  2）Hash切分
    拆分方法：根据sharding key计算hash；hash取模，hash mod 2^n。
    其中2^n为拆分的数据库的个数，n为整数。 
  3）hash切分——如何扩展？
    拆分方法：2个集群扩展为4个集群，每个集群有2个库
  4）1个库扩展为2个库
    库1:hash mod 2 = 0,库2:hash mod 2 = 1
    历史数据迁移方法
    原始库主备模式：master0-slave0
    新扩展的库：master1-slave1
    master0和slave0断开，master0作为hash0的主，
    slave0作为hash1的主，master0中删除hash=1的数据，slave0中删除hash=0的数据
    master1作为master0的备，slave1作为slave0的备
    
    一般采用mod来切分，一开始确定切分数据库的个数，通过hash取模来决定使用哪台。这种方法能够平均地来分配数据，但是伴随
    着数据量的增大，需要进行扩展的时候，这种方式无法做到在线扩容。每增加节点的时候，就需要对hash 算法重新运算。
    所以采用这种方法推荐采用mod 2^n这种一致性哈希
    以点评统一订单库为例，分库分表的方案是32*32的，即通过userId后四位mod 32分到32个库中，同时再将userId后四位
    div 32 mod 32将每个库分为32个表，共计分为1024张表。其线上部署情况为8个集群(主从)，每个集群4个库
  5）2个库扩展为4个库
    原始库1:hash mod 2 = 0,
    原始库2:hash mod 2 = 1
    
    扩展库1:hash mod 4 = 0,
    扩展库2:hash mod 4 = 1,
    扩展库3:hash mod 4 = 2,
    扩展库4:hash mod 4 = 3
    
    扩展方法：
    原始库1 对应扩展库1,3
    原始库2 对应扩展库2,4   
#### 4 网关系统-zuul2.0
  zuul1.0客户端发起的请求后需要同步等待zuul网关返回，zuul网关这边对每个请求会分派一个线程来处理，这会导致并发请求
  数量有限。zuul2.0使用netty作为异步通讯，大大加大并发请求量。
#### 5 服务注册与发现
  一致性（Consistency），可用性（Availability），分区容错性（Partition tolerance）。最多满足其中两个特性，
  无法同时满足三个。
#### 6 Zk vs Eureka
                Zookeeper（ZK）                                       Eureka
  设计原则          CP                                                  AP
  优点            数据强一致                                           服务高可用
  缺点            网络分区会影响Leader选举，超过阈值后集群不可用      服务节点间的数据可能不一致；Client-Server间的数据可能不一致；
  适用场景        单机房集群，对数据一致性要求较高                   云机房集群，跨越多机房部署；对注册中心服务可用性要求较高                    